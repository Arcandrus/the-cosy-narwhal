{% extends "base.html" %}

{% block content %}
<h1>Edit Product</h1>

<form method="get" action=".">
    <label for="search">Search by code or name:</label>
    <input type="text" name="search" id="search" value="{{ request.GET.search }}">
    <button type="submit">Search</button>
</form>
{% if search_query %}
    <h3>Search Results:</h3>
    <ul>
        {% for product in products %}
            <li>
                <a href="{% url 'edit_product' %}?product_id={{ product.id }}">
                    {{ product.code }} - {{ product.name }}
                </a>
            </li>
        {% endfor %}
    </ul>
{% else %}
    <p>No products found.</p>
{% endif %}

<form method="get" action=".">
    <label for="product_select">Or select product from list:</label>
    <select name="product_id" id="product_select" onchange="this.form.submit()">
        <option value="">Select a product</option>
        {% for p in products %}
            <option value="{{ p.id }}" {% if selected_product and p.id == selected_product.id %}selected{% endif %}>{{ p.name }} ({{ p.code }})</option>
        {% endfor %}
    </select>
</form>

{% if form %}
    <hr>
    <h2>Editing: {{ selected_product.name }} ({{ selected_product.code }})</h2>
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        {{ form.as_p }}
        <input type="hidden" name="product_id" value="{{ selected_product.id }}">
        <button type="submit">Save changes</button>
    </form>
{% endif %}
{% endblock %}